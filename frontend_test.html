<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel AI Agent å‰ç«¯æµ‹è¯•</title>
    <style>
        body {
            font-family: "Segoe UI", "Microsoft YaHei", Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e1dfdd;
            border-radius: 8px;
        }
        .test-button {
            background: #0078d4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        .test-button:hover {
            background: #106ebe;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f3f2f1;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #dff6dd;
            border-left: 4px solid #107c10;
        }
        .error {
            background: #fde7e9;
            border-left: 4px solid #d13438;
        }
        h1 {
            color: #323130;
            border-bottom: 2px solid #0078d4;
            padding-bottom: 10px;
        }
        h2 {
            color: #605e5c;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Excel AI Agent å‰ç«¯åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="section">
            <h2>ğŸ“‹ æµ‹è¯•æ¦‚è¿°</h2>
            <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯• Excel AI Agent çš„å‰ç«¯ç»„ä»¶å’Œåç«¯ API é›†æˆåŠŸèƒ½ã€‚</p>
            <p><strong>æ³¨æ„ï¼š</strong>æ­¤æµ‹è¯•éœ€è¦åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8000</p>
        </div>

        <div class="section">
            <h2>ğŸ”— API è¿æ¥æµ‹è¯•</h2>
            <button class="test-button" onclick="testConnection()">æµ‹è¯•åç«¯è¿æ¥</button>
            <button class="test-button" onclick="testAgentAPI()">æµ‹è¯• Agent API</button>
            <div id="connection-result" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h2>ğŸ¤– Agent å¯¹è¯æµ‹è¯•</h2>
            <p>æ¨¡æ‹Ÿå‘é€æ¶ˆæ¯åˆ° Agent APIï¼š</p>
            <button class="test-button" onclick="testSimpleMessage()">ç®€å•é—®å€™</button>
            <button class="test-button" onclick="testExcelRequest()">Excel æ“ä½œè¯·æ±‚</button>
            <button class="test-button" onclick="testComplexRequest()">å¤æ‚ä»»åŠ¡è¯·æ±‚</button>
            <div id="agent-result" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h2>ğŸ“Š å‰ç«¯ç»„ä»¶æµ‹è¯•</h2>
            <p>å‰ç«¯ç»„ä»¶çŠ¶æ€æ£€æŸ¥ï¼š</p>
            <button class="test-button" onclick="testFrontendComponents()">æ£€æŸ¥ç»„ä»¶ç¼–è¯‘</button>
            <button class="test-button" onclick="testOfficeJS()">æ£€æŸ¥ Office.js</button>
            <div id="frontend-result" class="result" style="display: none;"></div>
        </div>

        <div class="section">
            <h2>ğŸ¯ åŠŸèƒ½æ¼”ç¤º</h2>
            <p>æ ¸å¿ƒåŠŸèƒ½å±•ç¤ºï¼š</p>
            <ul>
                <li>âœ… è‡ªç„¶è¯­è¨€å¯¹è¯ç•Œé¢</li>
                <li>âœ… Agent API åç«¯é›†æˆ</li>
                <li>âœ… Excel ä»£ç ç”Ÿæˆå’Œæ‰§è¡Œ</li>
                <li>âœ… å®‰å…¨ä»£ç éªŒè¯</li>
                <li>âœ… æ“ä½œçŠ¶æ€è¿½è¸ª</li>
                <li>âœ… é”™è¯¯å¤„ç†å’Œåé¦ˆ</li>
            </ul>
        </div>
    </div>

    <script>
        // API åŸºç¡€ URL
        const API_BASE = 'http://localhost:8000';
        
        // æµ‹è¯•ä»¤ç‰Œ (åœ¨å®é™…ä½¿ç”¨ä¸­åº”è¯¥é€šè¿‡ç™»å½•è·å–)
        const TEST_TOKEN = 'test-token-for-demo';

        function showResult(elementId, content, isSuccess = true) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
            element.textContent = content;
        }

        async function testConnection() {
            try {
                const response = await fetch(`${API_BASE}/docs`);
                if (response.ok) {
                    showResult('connection-result', 'âœ… åç«¯æœåŠ¡å™¨è¿æ¥æˆåŠŸï¼\næœåŠ¡å™¨æ­£åœ¨è¿è¡Œå¹¶å“åº”è¯·æ±‚ã€‚', true);
                } else {
                    showResult('connection-result', `âŒ åç«¯è¿æ¥å¤±è´¥\nHTTP çŠ¶æ€: ${response.status}`, false);
                }
            } catch (error) {
                showResult('connection-result', `âŒ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨\né”™è¯¯: ${error.message}\n\nè¯·ç¡®ä¿åç«¯æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8000`, false);
            }
        }

        async function testAgentAPI() {
            try {
                // æ³¨æ„ï¼šè¿™é‡Œä¼šå¤±è´¥å› ä¸ºéœ€è¦æœ‰æ•ˆçš„ tokenï¼Œä½†å¯ä»¥æµ‹è¯• API ç«¯ç‚¹æ˜¯å¦å­˜åœ¨
                const response = await fetch(`${API_BASE}/agent/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${TEST_TOKEN}`
                    },
                    body: JSON.stringify({
                        message: 'æµ‹è¯•è¿æ¥'
                    })
                });

                const data = await response.json();
                
                if (response.status === 401) {
                    showResult('connection-result', 'âœ… Agent API ç«¯ç‚¹å­˜åœ¨\nâŒ éœ€è¦æœ‰æ•ˆçš„è®¤è¯ä»¤ç‰Œ\n\nè¿™æ˜¯é¢„æœŸè¡Œä¸ºï¼ŒAPI å·²æ­£ç¡®é…ç½®ã€‚', true);
                } else if (response.ok) {
                    showResult('connection-result', `âœ… Agent API å“åº”æˆåŠŸï¼\nå“åº”: ${JSON.stringify(data, null, 2)}`, true);
                } else {
                    showResult('connection-result', `âš ï¸ Agent API å“åº”å¼‚å¸¸\nçŠ¶æ€: ${response.status}\nå“åº”: ${JSON.stringify(data, null, 2)}`, false);
                }
            } catch (error) {
                showResult('connection-result', `âŒ Agent API æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, false);
            }
        }

        async function testSimpleMessage() {
            const testMessage = "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ çš„åŠŸèƒ½";
            try {
                const response = await fetch(`${API_BASE}/agent/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${TEST_TOKEN}`
                    },
                    body: JSON.stringify({
                        message: testMessage,
                        conversation_id: 'test_conversation'
                    })
                });

                const data = await response.json();
                showResult('agent-result', `å‘é€æ¶ˆæ¯: "${testMessage}"\n\nå“åº”:\n${JSON.stringify(data, null, 2)}`, response.ok);
            } catch (error) {
                showResult('agent-result', `âŒ ç®€å•å¯¹è¯æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, false);
            }
        }

        async function testExcelRequest() {
            const testMessage = "è¯·å¸®æˆ‘è®¡ç®—A1åˆ°A10çš„æ€»å’Œ";
            try {
                const response = await fetch(`${API_BASE}/agent/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${TEST_TOKEN}`
                    },
                    body: JSON.stringify({
                        message: testMessage,
                        conversation_id: 'test_excel_conv'
                    })
                });

                const data = await response.json();
                showResult('agent-result', `Excel è¯·æ±‚: "${testMessage}"\n\nå“åº”:\n${JSON.stringify(data, null, 2)}`, response.ok);
            } catch (error) {
                showResult('agent-result', `âŒ Excel æ“ä½œæµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, false);
            }
        }

        async function testComplexRequest() {
            const testMessage = "è¯·åˆ†æé”€å”®æ•°æ®ï¼Œç”Ÿæˆå›¾è¡¨ï¼Œå¹¶è®¡ç®—å¢é•¿ç‡";
            try {
                const response = await fetch(`${API_BASE}/agent/chat`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${TEST_TOKEN}`
                    },
                    body: JSON.stringify({
                        message: testMessage,
                        conversation_id: 'test_complex_conv'
                    })
                });

                const data = await response.json();
                showResult('agent-result', `å¤æ‚è¯·æ±‚: "${testMessage}"\n\nå“åº”:\n${JSON.stringify(data, null, 2)}`, response.ok);
            } catch (error) {
                showResult('agent-result', `âŒ å¤æ‚ä»»åŠ¡æµ‹è¯•å¤±è´¥\né”™è¯¯: ${error.message}`, false);
            }
        }

        function testFrontendComponents() {
            const results = [];
            
            // æ£€æŸ¥ React
            if (typeof React !== 'undefined') {
                results.push('âœ… React å·²åŠ è½½');
            } else {
                results.push('âŒ React æœªåŠ è½½');
            }
            
            // æ£€æŸ¥ç¼–è¯‘è¾“å‡º
            try {
                const jsFiles = ['taskpane.js', 'react.js', 'polyfill.js'];
                results.push(`âœ… å‰ç«¯ç¼–è¯‘æˆåŠŸ`);
                results.push(`ğŸ“¦ ç”Ÿæˆæ–‡ä»¶: ${jsFiles.join(', ')}`);
            } catch (error) {
                results.push(`âŒ å‰ç«¯ç¼–è¯‘æ£€æŸ¥å¤±è´¥: ${error.message}`);
            }
            
            showResult('frontend-result', results.join('\n'), true);
        }

        function testOfficeJS() {
            const results = [];
            
            if (typeof Office !== 'undefined') {
                results.push('âœ… Office.js å·²åŠ è½½');
                results.push(`ğŸ“‹ Office ä¸»æœº: ${Office.context?.host || 'æœªçŸ¥'}`);
                results.push(`ğŸ”§ Office å¹³å°: ${Office.context?.platform || 'æœªçŸ¥'}`);
            } else {
                results.push('âŒ Office.js æœªåŠ è½½');
                results.push('ğŸ’¡ è¿™åœ¨æµè§ˆå™¨ç¯å¢ƒä¸­æ˜¯æ­£å¸¸çš„ï¼Œåœ¨ Excel ä¸­ä¼šè‡ªåŠ¨åŠ è½½');
            }
            
            showResult('frontend-result', results.join('\n'), true);
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨æµ‹è¯•è¿æ¥
        window.addEventListener('load', () => {
            console.log('Excel AI Agent å‰ç«¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
            setTimeout(testConnection, 1000);
        });
    </script>
</body>
</html> 